<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ›¸å¯«å±±ãƒ»å·¡ç¦®å¸– | 8æ—¥å‘¨éŠ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- è¦–è¦ºé¢¨æ ¼ï¼šåœ“æ•™å¯ºãƒ»ç¦ªæ„ (Zen & Wood) --- */
        :root {
            --c-bg: #F7F4EB;       /* ç±³è‰²ç´‹ç†èƒŒæ™¯ */
            --c-text: #2c2825;     /* å¢¨é»‘ */
            --c-primary: #5c6e58;  /* è‹”ç¶  */
            --c-primary-dark: #3a4a36;
            --c-accent: #a63737;   /* æœ±å°ç´… */
            --c-wood: #8c7b6c;     /* å¤æœ¨è‰² */
            --c-light: #e8e4dc;
            --c-white: #ffffff;
            --shadow: 4px 4px 0px #E0E5D5; /* Soft Shadow */
            --radius: 16px;
            --font-main: "M PLUS Rounded 1c", "Helvetica Neue", Helvetica, "PingFang TC", "Microsoft JhengHei", sans-serif;
            --font-serif: "Songti TC", "Noto Serif TC", serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: var(--font-main);
            background-color: var(--c-bg);
            background-image: radial-gradient(#E0E5D5 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--c-text);
            padding-bottom: 90px;
        }

        header {
            text-align: center; padding: 24px 0 16px;
            background: linear-gradient(to bottom, var(--c-bg), rgba(244,241,234,0));
            position: sticky; top: 0; z-index: 100;
            backdrop-filter: blur(8px);
        }
        header h1 { font-family: var(--font-serif); font-size: 1.5rem; color: var(--c-primary-dark); margin: 0; letter-spacing: 2px;}
        header p { font-size: 0.8rem; color: var(--c-wood); margin-top: 4px; letter-spacing: 1px; }
        
        #weather-widget {
            font-size: 0.85rem;
            color: var(--c-primary);
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #weather-widget.visible { opacity: 1; }

        .container { max-width: 600px; margin: 0 auto; padding: 0 16px; }

        .card {
            background: var(--c-white);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid #E0E5D5;
            position: relative;
        }

        .btn {
            background: var(--c-primary); color: white; border: none;
            padding: 8px 16px; border-radius: 20px; cursor: pointer;
            font-size: 0.9rem; transition: 0.1s; display: inline-flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.95); }
        
        .btn-nav {
            background: var(--c-primary); 
            color: #fff;
            padding: 6px 12px; 
            font-size: 0.8rem; 
            border-radius: 20px; 
            text-decoration: none;
            margin-left: auto;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            transition: 0.1s;
        }
        .btn-nav:active { background: var(--c-primary-dark); transform: scale(0.95); }

        .day-header {
            background: var(--c-wood); color: white;
            padding: 12px 16px; border-radius: var(--radius);
            margin-bottom: 10px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            font-family: var(--font-serif);
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        .day-details { display: none; padding-left: 10px; border-left: 2px dashed var(--c-light); margin-left: 10px; animation: slideDown 0.3s ease-out; }
        .day-details.open { display: block; }
        
        .timeline-item { position: relative; padding-bottom: 20px; padding-left: 10px; border-bottom: 1px solid #fcfcfc; margin-bottom: 10px;}
        
        .item-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
        .time-badge {
            font-size: 0.85rem; font-weight: bold; color: var(--c-primary-dark);
            background: var(--c-light); padding: 2px 6px; border-radius: 4px; min-width: 45px; text-align: center;
        }
        .item-title { font-weight: bold; font-size: 1rem; color: #333; flex: 1; }

        .ai-tip-box {
            background-color: #f9f7f4;
            border: 1px solid #e0dcd5;
            border-radius: 8px;
            padding: 10px;
            margin-top: 6px;
            font-size: 0.85rem;
            color: #5d5550;
            display: flex;
            gap: 8px;
            line-height: 1.4;
        }
        .ai-icon { font-size: 1.2rem; }
        .ai-content strong { color: var(--c-accent); }

        .total-box {
            background: var(--c-primary-dark); color: white;
            padding: 24px; border-radius: var(--radius);
            text-align: right; margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        .total-label { font-size: 0.8rem; opacity: 0.8; letter-spacing: 1px; }
        .total-amount { font-size: 2.2rem; font-weight: bold; font-family: var(--font-serif); margin-top: 5px; }
        
        .expense-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 12px 0; }
        .expense-cost { font-weight: bold; color: var(--c-primary-dark); }
        .delete-btn { color: #ccc; padding: 4px 8px; font-size: 1.2rem; cursor: pointer; }
        .delete-btn:hover { color: var(--c-accent); }

        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; width: 100%; font-size: 1rem; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--c-primary); }

        .bottom-nav {
            position: fixed; bottom: 0; left: 0; transform: none;
            width: 100%; max-width: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 0;
            display: flex; justify-content: space-around; padding: 16px 0; z-index: 999;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            border: none;
            border-top: 1px solid #E0E5D5;
        }
        .nav-item { text-align: center; color: #aaa; font-size: 0.8rem; flex: 1; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--c-primary); font-weight: bold; transform: translateY(-2px); }
        .nav-icon { margin-right: 4px; }

        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1>æ›¸å¯«å±±ãƒ»å·¡ç¦®å¸–</h1>
    <p>2025.12.10 - 12.17</p>
    <div id="weather-widget">
        <span>ğŸ“ å®šä½ä¸­...</span>
    </div>
</header>

<div class="container">

    <div id="view-itinerary" class="view-section active">
        <div class="card" id="main-weather-card" style="background: linear-gradient(135deg, #7F7FD5 0%, #86A8E7 50%, #91EAE4 100%); color: white; border:none; padding:20px;">
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div>
                    <div id="weather-loc" style="font-size:0.85rem; opacity:0.9; letter-spacing:1px;">ğŸ“ å®šä½ä¸­...</div>
                    <div id="weather-temp" style="font-size:2.5rem; font-weight:bold; font-family: var(--font-serif);">--Â°C</div>
                </div>
                <div style="text-align:right;">
                    <div id="weather-icon" style="font-size:3rem;">ğŸŒ¤ï¸</div>
                    <div id="weather-desc" style="font-size:0.9rem;">--</div>
                </div>
            </div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3); display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 0.9rem;">æ˜æ—¥å¤©æ°£</div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="weather-tomorrow-icon" style="font-size: 1.2rem;"></span>
                    <span id="weather-tomorrow-temp" style="font-size: 1rem; font-weight: bold;">-- / --Â°C</span>
                </div>
            </div>
        </div>

        <div id="itinerary-list">
            </div>
        <div style="text-align:center; margin-bottom: 100px; color:#999; font-size:0.8rem;">
            é»æ“Šã€ŒğŸ“ å°èˆªã€å³å¯é–‹å•Ÿ Google Maps
        </div>
    </div>

    <div id="view-wallet" class="view-section">
        <div class="total-box">
            <div class="total-label">æ—…è²»ç¸½æ”¯å‡º (JPY)</div>
            <div class="total-amount">Â¥ <span id="total-val">0</span></div>
        </div>

        <div class="card">
            <h3 style="margin-top:0; font-size:1rem; color:var(--c-wood);">ğŸ–Šï¸ æ–°å¢æ”¯å‡º</h3>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <input type="text" id="input-item" placeholder="é …ç›® (å¦‚: çºœè»Šç¥¨)" style="flex:2;">
                <input type="number" id="input-cost" placeholder="é‡‘é¡" style="flex:1;">
            </div>
            <button class="btn" style="width:100%; margin-top:15px; height:45px;" onclick="addExpense()">åŠ å…¥æ¸…å–®</button>
        </div>

        <div class="card" id="expense-list" style="min-height:100px;">
            <div style="text-align:center; color:#ccc; padding:20px;">å°šç„¡è¨˜å¸³è³‡æ–™</div>
        </div>
        
        <div style="text-align:center; margin-bottom: 100px;">
             <button onclick="clearExpenses()" style="background:none; border:none; color:#999; text-decoration:underline; font-size:0.8rem; cursor:pointer;">æ¸…é™¤æ‰€æœ‰è¨˜éŒ„</button>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchView('itinerary', this)">
        <span class="nav-icon">â›©ï¸</span>è¡Œç¨‹å°èˆª
    </div>
    <div class="nav-item" onclick="switchView('wallet', this)">
        <span class="nav-icon">ğŸ‘›</span>æ—…è²»è¨˜å¸³
    </div>
</nav>

<script>
    // --- 1. è¡Œç¨‹èˆ‡ AI å»ºè­°è³‡æ–™åº« ---
    const itineraryData = [
        { 
            day: "Day 1 (12/10)", 
            title: "æŠµé”å²¡å±±", 
            items: [
                { t: "11:40", title: "å²¡å±±æ¡ƒå¤ªéƒæ©Ÿå ´", loc: "Okayama Momotaro Airport", tip: "å‡ºé—œå¾Œå‰å¾€ 2 è™Ÿå€™è»Šè™•æ­ä¹˜å·´å£«ã€‚" },
                { t: "14:00", title: "å²¡å±±è»Šç«™ (JR Pass)", loc: "Okayama Station JR Ticket Office", tip: "åœ¨æ­¤å…Œæ›ã€Œç€¨æˆ¶å…§æµ·é€±éŠåˆ¸ã€ä¸¦åŠƒä½ã€‚ç‡Ÿæ¥­è‡³ 20:00ã€‚", food: "å¾å¦»å£½å¸", menu: "å²¡å±±æ•£å£½å¸", gift: "å‰å‚™ç³°å­" },
                { t: "15:00", title: "å¾Œæ¨‚åœ’é£¯åº— Check-in", loc: "Okayama Koraku Hotel", tip: "é£¯åº—å°±åœ¨æ²³ç•”æ—ï¼Œé«˜å³¶å±‹ 8F å¯é ˜ shopper's cardã€‚" }
            ]
        },
        { 
            day: "Day 2 (12/11)", 
            title: "é‡‘åˆ€æ¯”ç¾…å®®ãƒ»å¾Œæ¨‚åœ’", 
            items: [
                { t: "08:52", title: "å²¡å±± â†’ ç´å¹³", loc: "Okayama Station", tip: "æ­ä¹˜å—é¢¨è™Ÿï¼Œä½¿ç”¨é€±éŠåˆ¸è¨˜å¾—åŠƒä½ç¬¬ä¸€ç¯€è»Šå»‚ã€‚" },
                { t: "10:00", title: "é‡‘åˆ€æ¯”ç¾…å®®", loc: "Kotohira-gu", tip: "é”äººå»ºè­°ï¼šç›´æ¥æ””è¨ˆç¨‹è»Šååˆ°ã€Œç¥æ¤¿å’–å•¡å»³ã€(500éš)ï¼Œçœä¸‹ä¸€åŠçˆ¬æ¨“æ¢¯çš„åŠ›æ°£ã€‚", food: "è³‡ç”Ÿå ‚ç¥æ¤¿", menu: "ç¥æ¤¿è–ä»£", gift: "ç¸é¥…é ­" },
                { t: "12:30", title: "åˆé¤ï¼šlwanoya çƒé¾éºµ", loc: "Iwanoya Udon Kotohira", tip: "åƒæ‹œå¾Œçš„è£œå……é«”åŠ›é¦–é¸ã€‚", food: "Iwanoya", menu: "é‡œç‰çƒé¾éºµ" },
                { t: "15:45", title: "å²¡å±±å¾Œæ¨‚åœ’ / å²¡å±±åŸ", loc: "Okayama Korakuen", tip: "æ­è·¯é¢é›»è»Šè‡³ã€ŒåŸä¸‹ç«™ã€ï¼Œå¾Œé–€ä¸Šè»Šã€å‰é–€ä¸‹è»Šå‡ºç¤ºé€±éŠåˆ¸ã€‚", food: "ç¢§æ°´åœ’", menu: "ç‚¸å‰å‚™ç³°å­", gift: "å²¡å±±ç™½æ¡ƒæœå‡" }
            ]
        },
        { 
            day: "Day 3 (12/12)", 
            title: "å§¬è·¯åŸãƒ»æ›¸å¯«å±±åœ“æ•™å¯º", 
            items: [
                { t: "08:10", title: "å§¬è·¯ç«™ â†’ æ›¸å¯«å±±", loc: "Himeji Station Bus Terminal", tip: "æ–¼ç«™å‰ 10 è™Ÿç«™ç‰Œæ­ç¥å§¬å·´å£«ï¼Œçµ‚é»ç«™ã€Œæ›¸å¯«å±±çºœè»Šã€ä¸‹è»Šã€‚" },
                { t: "09:00", title: "æ›¸å¯«å±±åœ“æ•™å¯º", loc: "Shoshazan Engyo-ji", tip: "é›»å½±ã€Šæœ«ä»£æ­¦å£«ã€‹å–æ™¯åœ°ã€‚ä¸Šå±±å¾Œéœ€ä»˜ 1000 å††æ­ä¹˜å°å·´å…¥å±±ã€‚", food: "åœ“æ•™å¯ºæœƒé¤¨", menu: "ç²¾é€²æ–™ç† (éœ€é ç´„)" },
                { t: "12:00", title: "åˆé¤ï¼šMoriju é°»é­šé£¯", loc: "Moriju Himeji", tip: "åƒè§€å®Œæ›¸å¯«å±±å¾Œçš„åˆé¤å®‰æ’ã€‚" },
                { t: "13:30", title: "å§¬è·¯åŸã€å¥½å¤åœ’", loc: "Himeji Castle", tip: "æ—¥æœ¬ç¬¬ä¸€ååŸã€‚å›ç¨‹æ–¼ã€Œå§¬è·¯åŸå¤§æ‰‹é–€å‰ç«™ã€æ­å·´å£«å›è»Šç«™ã€‚", food: "Tamagoya", menu: "é›è›‹æ‹Œé£¯", gift: "ç‰æ¤¿ (å’Œè“å­)" }
            ]
        },
        { 
            day: "Day 4 (12/13)", 
            title: "å€‰æ•·ç¾è§€ â†’ ç§»å‹•æ¾å±±", 
            items: [
                { t: "09:40", title: "å€‰æ•·ç¾è§€åœ°å€", loc: "Kurashiki Bikan Historical Quarter", tip: "å¿…è¨ªï¼šå€‰æ•·æ¡ƒå­éœœæ·‡æ·‹ã€å»£æ¦®å ‚ã€é˜¿æ™ºç¥ç¤¾ã€‚", food: "å€‰æ•·æ¡ƒå­", menu: "ç•¶å­£æ°´æœè–ä»£", gift: "å€‰æ•·å¸†å¸ƒã€ç´™è† å¸¶" },
                { t: "13:11", title: "è¿”å›å²¡å±±å–è¡Œæ", loc: "Okayama Station", tip: "æº–å‚™ç§»å‹•åˆ°å››åœ‹ï¼Œé ç•™æ™‚é–“æ‹¿è¡Œæã€‚" },
                { t: "14:35", title: "ç‰¹æ€¥å¾€æ¾å±±", loc: "Okayama Station", tip: "æ­ä¹˜äºˆè®šç·šç‰¹æ€¥å‰å¾€æ„›åª›æ¾å±±ã€‚" },
                { t: "17:30", title: "æ™šé¤ï¼šç‚¸è±¬æ’", loc: "Matsuyama Daikaido", tip: "å…¥ä½å¤§è¡—é“é£¯åº—ï¼Œäº¤é€šæ–¹ä¾¿ã€‚", food: "ç‚¸è±¬æ’æ¸…ä¸¸", menu: "ç‚¸è±¬æ’è–ä»£ (æŒ‘æˆ°è€…é™å®š)" }
            ]
        },
        { 
            day: "Day 5 (12/14)", 
            title: "æ¾å±±åŸãƒ»é“å¾Œæº«æ³‰", 
            items: [
                { t: "10:30", title: "æ¾å±±åŸ (çºœè»Š)", loc: "Matsuyama Castle", tip: "é«”é©—æ­ä¹˜çºœè»Šä¸Šå±±ï¼Œå‘¨é‚Šå¯é€›ä»Šæ²»æ¯›å·¾åº—ã€‚", gift: "ä»Šæ²»æ¯›å·¾" },
                { t: "13:00", title: "åˆé¤ï¼šé¯›é­šé£¯", loc: "Matsuyama Taimeshi", tip: "æ„›åª›ç¸£å¿…åƒçš„ç‰¹è‰²é„‰åœŸæ–™ç†ã€‚", food: "ä¸¸æ°´ / ç§‹å˜‰", menu: "å®‡å’Œå³¶é¯›é­šé£¯ (ç”Ÿé­šç‰‡å¼)" },
                { t: "15:00", title: "é“å¾Œæº«æ³‰ Check-in", loc: "Dogo Onsen", tip: "âš ï¸ æ³¨æ„ï¼šé£¯åº—å°¾ç«¯æœ‰é›»æ¢¯ç›´é”å¤§å»³ï¼Œè‹¥æœª Check-in éœ€ç”¨å°è¬›æ©Ÿè«‹é£¯åº—é–‹é–€ã€‚" },
                { t: "16:00", title: "é“å¾Œæº«æ³‰è¡—", loc: "Dogo Onsen Honkan", tip: "å°‘çˆºæ©Ÿé—œé˜ã€é“å¾Œæº«æ³‰æœ¬é¤¨æ‹ç…§ã€‚", food: "é“å¾Œéº¥é…’é¤¨", menu: "é“å¾Œå•¤é…’", gift: "ä¸€å…­å¡” (æŸšå­è›‹ç³•æ²)" }
            ]
        },
        { 
            day: "Day 6 (12/15)", 
            title: "ç€¨æˆ¶å…§æµ·æ±½èˆ¹ â†’ å»£å³¶", 
            items: [
                { t: "10:50", title: "å‰å¾€æ¾å±±æ¸¯", loc: "Matsuyama Tourist Port", tip: "é›»è»Šè½‰å·´å£«ï¼Œæ³¨æ„è½‰ä¹˜æ™‚é–“ã€‚" },
                { t: "14:15", title: "æ­ä¹˜ SEA PASEO æ¸¡è¼ª", loc: "Matsuyama Tourist Port Ferry Terminal", tip: "æŒ JR PASS æ›ç¥¨ã€‚èˆ¹é«”è¨­è¨ˆæ–°ç©ï¼Œé©åˆæ‹ç…§ã€‚" },
                { t: "16:57", title: "æŠµé”å»£å³¶æ¸¯", loc: "Hiroshima Port", tip: "è½‰æ­å»£å³¶é›»éµè‡³å¸‚å€é£¯åº—ã€‚" }
            ]
        },
        { 
            day: "Day 7 (12/16)", 
            title: "å®®å³¶ (åš´å³¶ç¥ç¤¾)ãƒ»å»£å³¶", 
            items: [
                { t: "08:25", title: "å®®å³¶å£æ­æ¸¡è¼ª", loc: "Miyajimaguchi Station", tip: "æ­ä¹˜ JR è¥¿æ—¥æœ¬æ¸¡è¼ªï¼ˆé€±éŠåˆ¸å¯ç”¨ï¼‰ï¼Œéœ€å¦ä»˜ç™»å³¶ç¨… 100å††/äººã€‚" },
                { t: "09:00", title: "åš´å³¶ç¥ç¤¾ã€å¤§é³¥å±…", loc: "Itsukushima Jinja", tip: "æ³¨æ„æ½®æ±æ™‚é–“ã€‚å°å¿ƒé¹¿ç¾¤æœƒåƒç´™å¼µã€‚", food: "ç‰¡è £å±‹", menu: "çƒ¤ç‰¡è £å®šé£Ÿ", gift: "å®®å³¶é£¯å‹ºã€ç´…è‘‰é¥…é ­" },
                { t: "14:30", title: "åŸçˆ†åœ“é ‚ã€å»£å³¶åŸ", loc: "Atomic Bomb Dome", tip: "æ­ä¹˜å¾ªç’°å·´å£«æˆ–è·¯é¢é›»è»Šç§»å‹•ã€‚" },
                { t: "18:00", title: "å…«ä¸å € (å»£å³¶ç‡’)", loc: "Hatchobori Hiroshima", tip: "æ™šé¤æ¨è–¦å»£å³¶ç‡’ï¼Œä¹Ÿå¯å»å”å‰è»»å¾·è£œè²¨ã€‚", food: "å…«æ˜Œ / è—¥ç ”å €", menu: "å»£å³¶ç‡’ (åŠ éºµ)", gift: "å»£å³¶æª¸æª¬è›‹ç³•" }
            ]
        },
        { 
            day: "Day 8 (12/17)", 
            title: "è¿”ç¨‹", 
            items: [
                { t: "07:15", title: "å»£å³¶ç«™æ­æ©Ÿå ´å·´å£«", loc: "Hiroshima Station Shinkansen Exit", tip: "åŒ—å£ 5 è™Ÿç«™ç‰Œï¼Œå‰é–€ä¸Šè»Šï¼Œå¯åˆ·ä¿¡ç”¨å¡ 1500å††ã€‚" },
                { t: "11:15", title: "å»£å³¶æ©Ÿå ´èµ·é£›", loc: "Hiroshima Airport", tip: "æ»¿è¼‰å›æ†¶ï¼Œå¹³å®‰å›å®¶ã€‚", gift: "å…«å¤©å ‚å¥¶æ²¹éºµåŒ…" }
            ]
        }
    ];

    // --- 2. æ ¸å¿ƒé‚è¼¯ ---
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        renderItinerary();
        renderExpenses();
        initWeather();
    });

    // åˆ‡æ›é é¢
    function switchView(viewName, navEl) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById(`view-${viewName}`).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navEl.classList.add('active');
    }

    // æ¸²æŸ“è¡Œç¨‹è¡¨ (ä½¿ç”¨æ¨™æº– Google Maps æœå°‹é€£çµ)
    function renderItinerary() {
        const list = document.getElementById('itinerary-list');
        list.innerHTML = itineraryData.map((day, idx) => `
            <div class="card">
                <div class="day-header" onclick="toggleDay(${idx})">
                    <span>${day.day} ${day.title}</span>
                    <span style="font-size:0.8rem;">â–¼</span>
                </div>
                <div class="day-details ${idx===0?'open':''}" id="day-${idx}">
                    ${day.items.map(item => `
                        <div class="timeline-item">
                            <div class="item-header">
                                <span class="time-badge">${item.t}</span>
                                <span class="item-title">${item.title}</span>
                                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.loc)}" 
                                   target="_blank" class="btn-nav">
                                   ğŸ“ å°èˆª
                                </a>
                            </div>
                            <div class="ai-tip-box">
                                <span class="ai-icon">ğŸ’¡</span>
                                <span class="ai-content">
                                    <strong>é”äºº Noteï¼š</strong>${item.tip}
                                </span>
                            </div>
                            ${item.food ? `
                            <div class="ai-tip-box" style="background-color:#fff5f5; border-color:#ffe0e0;">
                                <span class="ai-icon">ğŸœ</span>
                                <span class="ai-content"><strong>å¿…åƒç¾é£Ÿï¼š</strong>${item.food}</span>
                            </div>` : ''}
                            ${item.menu ? `
                            <div class="ai-tip-box" style="background-color:#f0f9ff; border-color:#d0eaff;">
                                <span class="ai-icon">ğŸ“‹</span>
                                <span class="ai-content"><strong>å¿…é»èœå–®ï¼š</strong>${item.menu}</span>
                            </div>` : ''}
                            ${item.gift ? `
                            <div class="ai-tip-box" style="background-color:#fff9e6; border-color:#ffeebb;">
                                <span class="ai-icon">ğŸ</span>
                                <span class="ai-content"><strong>å¿…è²·ä¼´æ‰‹ç¦®ï¼š</strong>${item.gift}</span>
                            </div>` : ''}
                        </div>
                    `).join('')}
                </div>
            </div>
        `).join('');
    }

    function toggleDay(idx) {
        const el = document.getElementById(`day-${idx}`);
        el.classList.toggle('open');
    }

    // --- 3. è¨˜å¸³åŠŸèƒ½ (Local Storage) ---
    let expenses = [];
    try {
        expenses = JSON.parse(localStorage.getItem('zenTripExpenses')) || [];
    } catch(e) { expenses = []; }

    function renderExpenses() {
        const list = document.getElementById('expense-list');
        const totalEl = document.getElementById('total-val');
        
        if (expenses.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">å°šç„¡è¨˜å¸³è³‡æ–™</div>';
            totalEl.innerText = "0";
            return;
        }

        let sum = 0;
        list.innerHTML = expenses.map((ex, idx) => {
            sum += parseInt(ex.cost);
            return `
                <div class="expense-item">
                    <div class="expense-info">
                        <span>${ex.item}</span>
                    </div>
                    <div>
                        <span class="expense-cost">Â¥${Number(ex.cost).toLocaleString()}</span>
                        <span class="delete-btn" onclick="delExpense(${idx})">Ã—</span>
                    </div>
                </div>
            `;
        }).join('');
        totalEl.innerText = sum.toLocaleString();
    }

    function addExpense() {
        const itemIn = document.getElementById('input-item');
        const costIn = document.getElementById('input-cost');
        const item = itemIn.value.trim();
        const cost = costIn.value;

        if(item && cost) {
            expenses.push({ item, cost });
            saveAndRender();
            itemIn.value = '';
            costIn.value = '';
        }
    }

    function delExpense(idx) {
        if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†è³‡æ–™ï¼Ÿ")) {
            expenses.splice(idx, 1);
            saveAndRender();
        }
    }
    
    function clearExpenses() {
        if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜å¸³ç´€éŒ„å—ï¼Ÿç„¡æ³•å¾©åŸå–”ï¼")) {
            expenses = [];
            saveAndRender();
        }
    }

    function saveAndRender() {
        localStorage.setItem('zenTripExpenses', JSON.stringify(expenses));
        renderExpenses();
    }

    // --- Weather Feature ---
    function initWeather() {
        const widget = document.getElementById('weather-widget');
        
        if (!navigator.geolocation) {
            widget.innerHTML = "<span>âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´å®šä½</span>";
            widget.classList.add('visible');
            return;
        }

        navigator.geolocation.getCurrentPosition(
            (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                fetchWeather(lat, lon);
            },
            (error) => {
                console.error("Geo Error:", error);
                widget.innerHTML = "<span>âš ï¸ ç„¡æ³•ç²å–ä½ç½®</span>";
                widget.classList.add('visible');
            }
        );
    }

    async function fetchWeather(lat, lon) {
        const widget = document.getElementById('weather-widget');
        // Main Card Elements
        const locEl = document.getElementById('weather-loc');
        const tempEl = document.getElementById('weather-temp');
        const iconEl = document.getElementById('weather-icon');
        const descEl = document.getElementById('weather-desc');
        const tomIconEl = document.getElementById('weather-tomorrow-icon');
        const tomTempEl = document.getElementById('weather-tomorrow-temp');

        try {
            // 1. Get Weather (Current + Daily)
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto`);
            const data = await res.json();
            
            // Current
            const current = data.current_weather;
            const temp = Math.round(current.temperature);
            const code = current.weathercode;
            const { icon, text } = getWeatherStatus(code);

            // Tomorrow (Index 1)
            const daily = data.daily;
            const tomCode = daily.weathercode[1];
            const tomMax = Math.round(daily.temperature_2m_max[1]);
            const tomMin = Math.round(daily.temperature_2m_min[1]);
            const tomStatus = getWeatherStatus(tomCode);

            // Update Header Widget
            widget.innerHTML = `<span>${icon} ç¾åœ¨æ°£æº« ${temp}Â°C ${text}</span>`;
            widget.classList.add('visible');

            // Update Main Card
            if(tempEl) {
                tempEl.innerText = `${temp}Â°C`;
                iconEl.innerText = icon;
                descEl.innerText = text;
                tomIconEl.innerText = tomStatus.icon;
                tomTempEl.innerText = `${tomMin}Â°C - ${tomMax}Â°C`;
            }

            // 2. Get Location Name (Reverse Geocoding)
            const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
            const geoData = await geoRes.json();
            const city = geoData.address.city || geoData.address.town || geoData.address.village || geoData.address.county || "æœªçŸ¥åœ°é»";
            
            if(locEl) locEl.innerText = `ğŸ“ ${city}`;
            
        } catch (e) {
            console.error("Weather API Error:", e);
            widget.innerHTML = "<span>âš ï¸ å¤©æ°£è³‡è¨Šæš«æ™‚ç„¡æ³•ä½¿ç”¨</span>";
            widget.classList.add('visible');
        }
    }

    function getWeatherStatus(code) {
        // WMO Weather interpretation codes
        if (code === 0) return { icon: 'â˜€ï¸', text: 'æ™´æœ—' };
        if (code >= 1 && code <= 3) return { icon: 'â›…', text: 'å¤šé›²' };
        if (code >= 45 && code <= 48) return { icon: 'ğŸŒ«ï¸', text: 'æœ‰éœ§' };
        if (code >= 51 && code <= 67) return { icon: 'ğŸŒ§ï¸', text: 'æœ‰é›¨' };
        if (code >= 71 && code <= 77) return { icon: 'â„ï¸', text: 'ä¸‹é›ª' };
        if (code >= 80 && code <= 82) return { icon: 'ğŸŒ¦ï¸', text: 'é™£é›¨' };
        if (code >= 95) return { icon: 'â›ˆï¸', text: 'é›·é›¨' };
        return { icon: 'ğŸŒ¡ï¸', text: '' };
    }

</script>

</body>
</html>
// --- æ›¿æ›åŸæœ¬çš„ Script å€å¡Š ---
    
    // å®šç¾©å…¨åŸŸéŒ¯èª¤è™•ç† (è®“éŒ¯èª¤ç›´æ¥å½ˆå‡ºä¾†)
    window.gm_authFailure = function() {
        alert("ğŸ”´ Google Maps é©—è­‰å¤±æ•—ï¼\n\nè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢ºï¼Œæˆ–æ˜¯å¦å·²å•Ÿç”¨è¨ˆè²»å¸³æˆ¶ã€‚");
        document.getElementById('loading-text').innerHTML = "<span style='color:red; font-weight:bold;'>é©—è­‰å¤±æ•— (Auth Failure)</span>";
    };

    // --- åˆå§‹åŒ– ---
    document.addEventListener('DOMContentLoaded', () => {
        renderItinerary();
        renderExpenses();
        // å˜—è©¦åˆå§‹åŒ–
        if(typeof google === 'undefined') {
            document.getElementById('loading-text').innerText = "âš ï¸ ç„¡æ³•é€£æ¥ Google ä¼ºæœå™¨ (ç¶²è·¯å•é¡Œæˆ– Key éŒ¯èª¤)";
        }
    });

    // --- Map Functions ---
    window.initMap = function() {
        // æ¸¬è©¦ API æ˜¯å¦èƒ½é‹ä½œ
        try {
            const mapEl = document.getElementById("map");
            const map = new google.maps.Map(mapEl, {
                center: { lat: 34.6663, lng: 133.9185 },
                zoom: 15
            });

            const service = new google.maps.places.PlacesService(map);
            // å˜—è©¦æœå°‹ä¸€å€‹ç°¡å–®åœ°é»ä¾†æ¸¬è©¦
            service.findPlaceFromQuery({
                query: "7-Eleven",
                fields: ["name", "geometry"]
            }, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    alert("âœ… æˆåŠŸï¼API Key é‹ä½œæ­£å¸¸ã€‚");
                    document.getElementById('loading-text').style.display = 'none';
                    // é€™è£¡å¯ä»¥ç¹¼çºŒåŸ·è¡ŒåŸæœ¬çš„é‚è¼¯...
                } else {
                    alert("âŒ åœ°åœ–è¼‰å…¥æˆåŠŸï¼Œä½†ã€Œæœå°‹åŠŸèƒ½ã€å¤±æ•—ã€‚\n\néŒ¯èª¤ä»£ç¢¼ï¼š" + status + "\n\nè«‹ç¢ºèª Google Cloud Console æœ‰å•Ÿç”¨ 'Places API'ã€‚");
                }
            });

        } catch (e) {
            alert("âŒ ç¨‹å¼åŸ·è¡ŒéŒ¯èª¤ï¼š\n" + e.message);
        }
    };
